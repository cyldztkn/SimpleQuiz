<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <title>A1 İngilizce Quiz</title>
    <style>
      body {
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-style: normal;
        background: linear-gradient(180deg, #8239f7 0%, #430d97 100%);
        min-height: 100dvh;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .quiz-container {
        background-color: #fff;
        border-radius: 44px;
        width: 80%;
        height: 50%;
        padding: 40px;
      }
      .question {
        margin-bottom: 20px;
        font-size: 36px;
        font-weight: 500;
      }
      .options {
        font-size: 32px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .option {
        /* margin: 5px 0; */
        padding: 24px 16px;
        background-color: #fff;
        border: 4px solid #eee;
        border-radius: 36px;
        cursor: pointer;
      }
      .option:hover {
        background-color: #eee;
      }
      .option.selected {
        background-color: #89b1e8;
        color: white;
      }
      .option.correct {
        background-color: #89e88c;
        color: white;
      }
      .option.incorrect {
        background-color: #e78788;
        color: white;
      }
      #next-btn,
      #restart-btn {
        font-size: 18px;
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-style: normal;
        display: none;
        width: 100%;
        padding: 24px 16px;
        background-color: #89b1e8;
        color: white;
        border: none;
        border-radius: 36px;
        margin-top: 20px;
        cursor: pointer;
      }
      #result {
        margin-top: 20px;
        text-align: center;
        font-weight: bold;
      }
      .progress-container {
        width: 100%;
        background-color: #eee;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      .progress-bar {
        width: 0%;
        height: 20px;
        background-color: #89e88c;
        border-radius: 5px;
        transition: width 0.5s ease-in-out;
      }
      h4 {
        font-size: 20px;
        font-weight: 400;
        display: inline;
      }
    </style>
  </head>
  <body>
    <div class="quiz-container">
      <div id="quiz"></div>
      <button id="next-btn">Sonraki Soru</button>
      <button id="restart-btn">Quizi Yeniden Başlat</button>
      <div id="result"></div>
    </div>
    <script>
      class Quiz {
        constructor(quizData) {
          // Local Storage'dan son durumu al
          const savedState = this.getSavedState();

          this.questions = this.shuffleAndSelectQuestions(
            quizData.questions,
            savedState
          );
          this.totalQuestions = this.questions.length;
          this.currentQuestionIndex = savedState
            ? savedState.currentQuestionIndex
            : 0;
          this.correctAnswers = savedState ? savedState.correctAnswers : 0;
          this.incorrectAnswers = savedState ? savedState.incorrectAnswers : 0;

          this.quizElement = document.getElementById("quiz");
          this.resultElement = document.getElementById("result");
          this.nextButton = document.getElementById("next-btn");
          this.restartButton = document.getElementById("restart-btn");

          this.nextButton.addEventListener("click", () => this.nextQuestion());
          this.restartButton.addEventListener("click", () =>
            this.restartQuiz()
          );

          this.loadQuestion();
        }

        // Soruları karıştır ve sınırlı sayıda soru seç
        shuffleAndSelectQuestions(questions, savedState) {
          // Eğer daha önce kaydedilmiş bir durum varsa, o soruları kullan
          if (savedState && savedState.questions) {
            return savedState.questions;
          }

          // Soruları karıştır
          const shuffledQuestions = questions.sort(() => Math.random() - 0.5);

          // İlk 20 soruyu seç
          return shuffledQuestions;
        }

        // Local Storage'dan son durumu al
        getSavedState() {
          const savedQuizState = localStorage.getItem("quizState");
          return savedQuizState ? JSON.parse(savedQuizState) : null;
        }

        // Mevcut durumu Local Storage'a kaydet
        saveState() {
          const state = {
            currentQuestionIndex: this.currentQuestionIndex,
            questions: this.questions,
            correctAnswers: this.correctAnswers,
            incorrectAnswers: this.incorrectAnswers,
          };
          localStorage.setItem("quizState", JSON.stringify(state));
        }

        createProgressBar() {
          const progressContainer = document.createElement("div");
          progressContainer.className = "progress-container";

          const progressBar = document.createElement("div");
          progressBar.className = "progress-bar";
          progressBar.id = "progress-bar";

          progressContainer.appendChild(progressBar);

          return progressContainer;
        }

        updateProgressBar() {
          const progressBar = document.getElementById("progress-bar");
          const progressPercentage =
            ((this.currentQuestionIndex + 1) / this.totalQuestions) * 100;
          progressBar.style.width = `${progressPercentage}%`;
        }

        loadQuestion() {
          this.quizElement.innerHTML = "";
          this.nextButton.style.display = "none";

          if (this.currentQuestionIndex >= this.questions.length) {
            this.showResult();
            return;
          }

          const currentQuestion = this.questions[this.currentQuestionIndex];

          this.quizElement.innerHTML = `
          <div class="progress-container">
            <div class="progress-bar" id="progress-bar" style="width: ${
              (this.currentQuestionIndex / this.totalQuestions) * 100
            }%"></div>
              </div>
              <div class="question">
              <h2>Soru - ${this.currentQuestionIndex + 1} / ${
            this.totalQuestions
          }</h2>
              <p>${currentQuestion.question}</p>
            </div>
            <div class="options">
              ${currentQuestion.options
                .map((option) => `<div class="option">${option}</div>`)
                .join("")}
            </div>
          `;

          const optionElements = this.quizElement.querySelectorAll(".option");
          optionElements.forEach((optionEl) => {
            optionEl.addEventListener("click", (e) => this.selectOption(e));
          });

          // Durumu kaydet
          this.saveState();
        }

        selectOption(e) {
          const selectedOption = e.target;
          const currentQuestion = this.questions[this.currentQuestionIndex];
          const optionElements = this.quizElement.querySelectorAll(".option");

          if (this.optionSelected) return;

          this.optionSelected = true;

          optionElements.forEach((el) => {
            el.removeEventListener("click", (e) => this.selectOption(e));
          });

          optionElements.forEach((el) => {
            if (el.textContent === currentQuestion.correctAnswer) {
              el.classList.add("correct");
            }
          });

          if (selectedOption.textContent === currentQuestion.correctAnswer) {
            selectedOption.classList.add("correct");
            this.correctAnswers++;
          } else {
            selectedOption.classList.add("incorrect");
            this.incorrectAnswers++;
          }

          this.nextButton.style.display = "block";

          // Durumu kaydet
          this.saveState();
        }

        nextQuestion() {
          this.currentQuestionIndex++;
          this.optionSelected = false;
          this.loadQuestion();
        }

        showResult() {
          this.quizElement.innerHTML = "";
          this.nextButton.style.display = "none";
          this.restartButton.style.display = "block";

          this.resultElement.innerHTML = `
            <h2>Quiz Sonucu</h2>
            <p>Toplam Soru: ${this.totalQuestions}</p>
            <p>Doğru Cevap: ${this.correctAnswers}</p>
            <p>Yanlış Cevap: ${this.incorrectAnswers}</p>
          `;

          // Local Storage'daki quiz durumunu temizle
          localStorage.removeItem("quizState");
        }

        restartQuiz() {
          // Local Storage'daki quiz durumunu temizle
          localStorage.removeItem("quizState");

          // Quiz'i sıfırla
          this.currentQuestionIndex = 0;
          this.correctAnswers = 0;
          this.incorrectAnswers = 0;
          this.optionSelected = false;
          this.resultElement.innerHTML = "";
          this.restartButton.style.display = "none";

          // Yeni bir fetch gerekiyorsa, fetching fonksiyonunu çağırabilirsiniz
          fetching();
        }
      }

      let fetching = async () => {
        try {
          console.log("fetch çalıştı");
          let response = await fetch("./questions.json");
          let data = await response.json();

          new Quiz(data);
        } catch (error) {
          console.error("Soru yüklenirken hata oluştu:", error);
        }
      };

      // Sayfa yüklendiğinde quiz'i başlat
      fetching();
    </script>
  </body>
</html>
