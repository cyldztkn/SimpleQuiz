<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <title>A1 İngilizce Quiz</title>
    <style>
      body {
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-style: normal;
        background: linear-gradient(180deg, #8239f7 0%, #430d97 100%);
        min-height: 100dvh;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .quiz-container {
        background-color: #fff;
        border-radius: 44px;
        width: 80%;
        height: 50%;
        padding: 40px;
      }
      .question {
        margin-bottom: 20px;
        font-size: 36px;
        font-weight: 500;
      }
      .options {
        font-size: 32px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .option {
        /* margin: 5px 0; */
        padding: 24px 16px;
        background-color: #fff;
        border: 4px solid #eee;
        border-radius: 36px;
        cursor: pointer;
      }
      .option:hover {
        background-color: #eee;
      }
      .option.selected {
        background-color: #89b1e8;
        color: white;
      }
      .option.correct {
        background-color: #89e88c;
        color: white;
      }
      .option.incorrect {
        background-color: #e78788;
        color: white;
      }
      #next-btn,
      #restart-btn {
        font-size: 18px;
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-style: normal;
        display: none;
        width: 100%;
        padding: 24px 16px;
        background-color: #89b1e8;
        color: white;
        border: none;
        border-radius: 36px;
        margin-top: 20px;
        cursor: pointer;
      }
      #result {
        margin-top: 20px;
        text-align: center;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="quiz-container">
      <div id="quiz"></div>
      <button id="next-btn">Sonraki Soru</button>
      <button id="restart-btn">Quizi Yeniden Başlat</button>
      <div id="result"></div>
    </div>

    <script>
      let fetching = async () => {
        console.log("fetch çalıştı");
        let response = await fetch("./questions.json");
        let data = await response.json();
        data.questions.sort(() => Math.random() - 0.5);

        new Quiz(data);
      };
      fetching();

      class Quiz {
        constructor(quizData) {
          this.questions = quizData.questions;
          this.currentQuestionIndex = 0;
          this.quizElement = document.getElementById("quiz");
          this.resultElement = document.getElementById("result");
          this.nextButton = document.getElementById("next-btn");
          this.restartButton = document.getElementById("restart-btn");

          this.nextButton.addEventListener("click", () => this.nextQuestion());
          this.restartButton.addEventListener("click", () =>
            this.restartQuiz()
          );

          this.loadQuestion();
        }

        loadQuestion() {
          // Önceki soru ve butonları temizle
          this.quizElement.innerHTML = "";
          this.nextButton.style.display = "none";

          // Eğer tüm sorular tamamlandıysa
          if (this.currentQuestionIndex >= this.questions.length) {
            this.quizElement.innerHTML = "<p>Tüm soruları gördünüz.</p>";
            return;
          }

          const currentQuestion = this.questions[this.currentQuestionIndex];

          this.quizElement.innerHTML = `
                          <div class="question">
                            <h2>Soru - ${this.currentQuestionIndex + 1} </h2>
                              <p>${currentQuestion.question}</p>
                          </div>
                          <div class="options">
                              ${currentQuestion.options
                                .map(
                                  (option) =>
                                    `<div class="option">${option}</div>`
                                )
                                .join("")}
                          </div>
                      `;

          const optionElements = this.quizElement.querySelectorAll(".option");
          optionElements.forEach((optionEl) => {
            optionEl.addEventListener("click", (e) => this.selectOption(e));
          });
        }

        selectOption(e) {
          const selectedOption = e.target;
          const currentQuestion = this.questions[this.currentQuestionIndex];
          const optionElements = this.quizElement.querySelectorAll(".option");

          // Daha önce seçim yapılmışsa tekrar seçime izin verme
          if (this.optionSelected) return;

          // Seçim yapıldığını işaretle
          this.optionSelected = true;

          // Tüm seçeneklerin tıklanmasını engelle
          optionElements.forEach((el) => {
            el.removeEventListener("click", (e) => this.selectOption(e));
          });

          // Doğru cevabı bul ve renklendir
          optionElements.forEach((el) => {
            if (el.textContent === currentQuestion.correctAnswer) {
              el.classList.add("correct");
            }
          });

          // Seçilen seçeneği işaretle
          if (selectedOption.textContent === currentQuestion.correctAnswer) {
            selectedOption.classList.add("correct");
          } else {
            selectedOption.classList.add("incorrect");
          }

          // Sonraki soru butonunu göster
          this.nextButton.style.display = "block";
        }

        nextQuestion() {
          this.currentQuestionIndex++;
          this.optionSelected = false;
          this.loadQuestion();
        }

        restartQuiz() {
          this.currentQuestionIndex = 0;
          this.optionSelected = false;
          this.resultElement.innerHTML = "";
          this.restartButton.style.display = "none";
          this.loadQuestion();
        }
      }
    </script>
  </body>
</html>
